* [2021-1-20 Wed] - possible topics for impedance methods paper 
** comparison of linear chirp, logarithmic chirp, white noise
*** also maybe neuron tool and/or method from pyramidal paper 
*** slew rate 
** srdjan's suggestion regarding poor access 
** analysis of asymmetric chirp response 
*** for instance, Rich2020-yl fig7 1.5 mV difference 
 
* [2021-1-28 Thu] - asym chirp response 
** asymmetric chirp response 
*** logspaced amplitude from 0.01 to 0.31 
*** want to plot assymetry (mV) vs mean squared error 
*** asymmetric.py: v0.01 - sensitivity analysis of asymmetric voltage responses in computing impedance

* [2021-1-29 Fri] - more asym chirp response 
** results from yesterday 
*** rerunning the sim because screwed up asymmetry calculation 
*** MSE increases exponentially w/ current amplitude anyway
**** much larger errors in amplitude than phase 
*** examples subfig 
from getCells import M1Cell   
s = M1Cell()  
seg = s.net.cells[0].secs['soma']['hObj'](0.5)   
from neuron import h, gui    
import numpy as np  
from chirpUtils import getChirp, applyChirpZin  
from sklearn.metrics import mean_squared_error 
 
amps = np.logspace(np.log10(0.015), np.log10(0.31), num=9, endpoint=True) 
 
f0, f1, t0, Fs, delay = 0.5, 20, 20, 1000, 5 
 
phaseErr = [] 
ampErr = [] 
asym = [] 
 
soma_v = h.Vector().record(seg._ref_v)      
time = h.Vector().record(h._ref_t)  
 
amp = 0.01  
print('Running ' + str(amp)) 
I, t = getChirp(f0, f1, t0, amp, Fs, delay) 
base = applyChirpZin(I, t, seg, t0, delay, Fs, f1)

base_v_trim = [v for v, T in zip(soma_v, time) if 4900 < T < 25100]                  
base_v_trim = np.subtract(base_v_trim, base_v_trim[0])
t_trim = [T for T in time if 4900 < T < 25100] 

amp = amps[-1]
print('Running ' + str(amp)) 
I, t = getChirp(f0, f1, t0, amp, Fs, delay) 
out = applyChirpZin(I, t, seg, t0, delay, Fs, f1)   

v_trim = [v for v, T in zip(soma_v, time) if 4900 < T < 25100]                               
v_trim = np.subtract(v_trim, v_trim[0])

from matplotlib import pyplot as plt
plt.ion()
plt.figure()
plt.subplot(2,3,1)
plt.plot([(T-5100)/1000 for T in t_trim], base_v_trim, label='0.01 mV', color='black')
plt.title('0.01 mV Assymetry', fontsize=16)
plt.xlabel('Time (s)', fontsize=14)
plt.ylabel(r'$\Delta$ V$_{memb}$ (mV)', fontsize=14)
plt.ylim(-0.6, 0.6)
plt.xlim(-0.1,20.1)
plt.xticks(fontsize=12)
plt.yticks(fontsize=12)
plt.subplot(2,3,4)
plt.plot([(T-5100)/1000 for T in t_trim], v_trim, label='1.20 mV', color='gray')
plt.title('1.20 mV Assymetry', fontsize=16)    
plt.xlabel('Time (s)', fontsize=14)
plt.ylabel(r'$\Delta$ V$_{memb}$ (mV)', fontsize=14)
plt.xticks(fontsize=12)
plt.yticks(fontsize=12)
plt.ylim(-18,18)
plt.xlim(-0.1, 20.1)
plt.subplot(2,3,2)
plt.plot(out['Freq'], out['ZinAmp'], label='1.20 mV', color='gray')
plt.plot(base['Freq'], base['ZinAmp'], label='0.01 mV', color='black')
plt.xlabel('Frequency (Hz)', fontsize=14)
plt.ylabel(r'|Z$_{in}$| (M$\Omega$)', fontsize=14)
plt.title('ZAP', fontsize=16)
plt.xticks(fontsize=12)
plt.yticks(fontsize=12)
plt.xlim(0,20.5)
plt.subplot(2,3,3)
plt.plot(out['Freq'], out['ZinPhase'], label='1.20 mV', color='gray')
plt.plot(base['Freq'], base['ZinPhase'], label='0.01 mV', color='black')
plt.xlabel('Frequency (Hz)', fontsize=14)
plt.ylabel(r'$\Phi_{in}$ (radians)', fontsize=14)
plt.title('ZPP', fontsize=16)
plt.xticks(fontsize=12)
plt.yticks(fontsize=12)
plt.xlim(0,20.5)

* [2021-1-30 Sat] - asym vs mse amp and phase 
** code for plot 
from scipy.io import loadmat 
data = loadmat('asym_sensitivity_v2.mat')
from matplotlib import pyplot as plt 
plt.ion()
import numpy as np
plt.figure()
plt.subplot(2,3,5)
# plt.plot(data['asym'][0], np.sqrt(data['ampErr'][0]), color='k', linestyle='-', linewidth=1.5)
plt.semilogx(data['asym'][0], np.sqrt(data['ampErr'][0]), color='k', linestyle='-', linewidth=1.5)
plt.scatter(data['asym'][0], np.sqrt(data['ampErr'][0]), color='k', linewidth=1.5)
plt.xlabel('Response Assymetry (mV)', fontsize=14)
plt.ylabel(r'Root Mean Squared Error (M$\Omega$)', fontsize=14)
plt.title('ZAP Error', fontsize=16)
plt.xticks(fontsize=12)
plt.yticks(fontsize=12)
plt.subplot(2,3,6)
# plt.plot(data['asym'][0], np.sqrt(data['phaseErr'][0]), color='k', linestyle='-', linewidth=1.5)
plt.semilogx(data['asym'][0], np.sqrt(data['phaseErr'][0]), color='k', linestyle='-', linewidth=1.5)
plt.scatter(data['asym'][0], np.sqrt(data['phaseErr'][0]), color='k', linewidth=1.5)
plt.xlabel('Response Assymetry (mV)', fontsize=14)
plt.ylabel(r'Root Mean Squared Error (radians)', fontsize=14)
plt.title('ZPP Error', fontsize=16)
plt.xticks(fontsize=12)
plt.yticks(fontsize=12)
** [[responseAssymetry.svg][example traces, ZAPs, and ZPPs, and error graphs]]

* [2021-3-12 Fri] - refactoring code 
** putting together a separate repo from the PT impedance paper 
** rerunning validation code for M1 PT cell for soma 

* [2021-3-15 Mon] - search for K+ mediated resonance 
** looking for decent model exhibiting K+ mediated resonance 
*** granule cell, Dover2016-ov, https://senselab.med.yale.edu/ModelDB/ShowModel?model=206267&file=/GrC_FHF_ModelDB/#tabs-1
**** resonance frequencies around where it is in PTs 
*** DRG, Amir2003-ww, https://senselab.med.yale.edu/ModelDB/ShowModel?model=51022#tabs-1
**** low pass 
*** Izhikevich 2003... not sure I'm using it correctly 

* [2021-4-9 Fri] - getting back into it
** downsample impedance values 
zAmp_red = [] 
zPhase_red = [] 
while freqs_sorted[ind] <= f1: 
    find = np.argmin(np.square(np.subtract(base['Freq'],freqs_sorted[ind]))) 
    zAmp_red.append(base['ZinAmp'][find]) 
    zPhase_red.append(base['ZinPhase'][find]) 
    ind = ind + 1

* [2021-4-11 Sun] - sorting out proper validation 
** need valid impedance value for every estimated one
*** parallelized and generalized impedance validation procedure 
** looking at signal to noise ratio issues (combining noise / subthreshold oscillations + imepdance estimation)

* [2021-4-12 Mon] - log and noise 
** new functions/scripts for adding background noise and runnig log chirp 
** validation for 20 s noise frequencies still running 

* [2021-4-16 Fri] - chirp and noise comparisons 
** put together nice figure of chirp vs. noise comparison
*** should i include log chirp? - yes, log chirp is the best 
** trouble doing linear prediction
*** frequency domain mult and time domain convolution don't look right
*** may be my mistake 

* [2021-4-19 Mon] - noise parameter space 
** varied duration, window size for smoothing, and std of gaussian distribution

* [2021-4-22 Thu] - worked out issues w/ z calculation 
** previously interpolating I that is played into IClamp, now recording i from IClamp 
*** eliminates progressive errors in impedance phase 
*** [[figures/chirp_vs_logchirp_vs_noise_v2.svg][new comparison of log, chirp, and noise]] 
Comparison of using linear chirp, logarithmic chirp, and Gaussian noise 
to compute input impedance.  
Errors were computed against impedance measurements from our validation paradigm. 
Impedance amplitude and phase profiles are unfiltered. 
Top row: Linear and logarithmic chirps had instantaneous frequencies increasing 
from 0.5-20 Hz over 20 s. 
The noise stimulus was 20 s.
Left: In the low frequency range, logarithmic chirp has the largest errors. 
White noise has lower error, but there are transient spikes in |Z$_{in}$| as high 
as 6 M$\Omega$.
Linear chirp has the lowers MSE and good agreement with validated |Z$_{in}| at all
frequencies. 
Right: The same pattern can be seen in $\Phi_{in}$.
Bottom row: Linear and logarithmic chirps had instantaneous frequencies increasing 
from 0.5-500 Hz over 60 s. 
Left:  The largest errors in |Z$_{in}$| were from linear chirp, with errors at 
low frequencies as high as 20 M$\Omega#, but good agreement with validation 
|Z$_{in}$| at higher frequencies.  Logarithmic chirp has lower errors, but follows
a similar pattern.  Noise produces good agreement with validation |Z$_{in}$| across
the frequency spectrum, but still suffers from transient spikes.
Left: Computing $\Phi_{in}$ with gaussian white noise had the largest MSE with 
errors increasing at higher frequencies. Linear and logarithmic chirp have lower 
MSE, but follow the same pattern seen in |Z_{in}| with large errors at low
frequencies.
** comparison of noise durations - longer is better, but only a marginal improvement 
*** [[figures/compareNoiseDuration.svg][comparison of 2s vs 20s of white noise with 5nA std]]
** looking for optimal filter window size
*** [[figures/logChirp_errVsBinSize.svg][error vs bin size, filter before or after trim Z beyond freq lims]]
*** best for logarithmic chirp to filter before removing Z(0.5 < f < 20) w/
window size of 18

* [2021-4-23 Fri] - more optimal filter sizes 
** noise - also before removing Z(0.5 < f < 20) w/ window size of 18 - herre translates to 0.567 Hz 

* [2021-4-25 Sun] - returning to noise and response assymetry
** plusNoise.py: v0.01 - configured for linear chirp over 0.5 - 20 Hz over 50 noise parameter combos
** responseAsym.py: v0.00 - replaces assymetricNoise.py, configured for 20s chirp with amps as high as 0.31 

* [2021-4-26 Mon] - plotting yesterday's sim output 
** plotPlusNoise.py: v0.00 - plot amplitude and phase errs by amp and std of noise 
*** plotPlusNoise.py: v0.01 - adding optimal filter window size
** plusNoise.py - v0.02 - filter window sizes now range from 50-200
** plotAsym.py - v0.00 - plotting output from asymmetric chirp sims 

* [2021-4-27 Tue] - input impedance 
** bill liked, but definitely not thrilled about, existing figures 
** he and srdjan still very keen on access problem 
*** more important an issue in the apical dendrite since pipette tip needs to be
so much smaller 
*** figured out how to change input location in linear circuit builder 

* [2021-7-19 Mon] - circuit builder issues 
** trying to replicate circuit from DeFelice1997-kd, but can't export circuit to .ses  
*** from "Print matrix info": Circuit equations have 0 inconsistencies 
*** error/warning from "Create class":
Unhandled exception in event loop:
Exception None
Press ENTER to continue...                                                                           
NEURON: no label on cell port
 near line 1
 {mkclass()}
^
)
)
)
)
Exception in gui thread

* [2021-7-23 Fri] - progress with circuit builder 
** met with ted
*** wasn't saving session, instead was saving template (.hoc, rather than .ses)
*** need to label nodes, or at lease between cell and circuit 
*** suggested using different circuit layout
from neuron import h, gui 
soma = h.Section(name='soma')
h.load_file('simpleCellCircuit.ses')
*** couldn't get template working other day, just figured out how to attach, 
dont know where Isrc is 
# code
from neuron import h, gui 
soma = h.Section(name='soma')
h.load_file('secondClass.hoc')
lm = h.LM()
lm.Vm_loc(0.5, soma)

* [2021-7-27 Tue] - using fzap and simple model 
** have .ses working for chirp 
*** need to have channels to get RMP 
** olah paper
*** axon diameter:log-normal distribution with mean of 0.6 µm and variance of
0.4 µm2.

* [2021-8-2 Mon] - meeting w/ srdjan and ted today 
** notes for meeting 
*** ted seems to think no need for access resistance and junction potential,
bill and presumably srdjan feel otherwise 
**** two starter versions of the circuit 
***** [[figures/example_run_tedConfig.png][no representation of Racc]]
***** [[figures/example_run_billConfig.png][guessed some vals for Racc and J]]
*** olah paper 
**** could incorporate detailed representation of the pipette
[[figures/detailed_pipette.png][pipette values from olah]]
**** a lot of the paper's focus was on amplifier and other instrumentation - 
do we want to include this kind of detail?
*** srdjan have any useful recordings/data/values for this?
*** new circuit layout [[iclamp_circuit.ses][iclamp with junction potential]]

* [2021-12-9 Thu] - looking at sync freq from vaidya and johnston 
** code for plotting phase for trunk and oblique 
import json
from matplotlib import pyplot as plt 
import numpy as np
fig, axs = plt.subplots(1,2)
trunk = [1, 12, 22]
obliq = [102, 79, 87]
data = []
dists = []
for t in trunk:
    with open('imped_data/M1Cell_apic_' + str(t) + '.json', 'rb') as fileObj:
        tmp = json.load(fileObj)
    dists.append(tmp['dist'])
    data.append(tmp)
inds = np.argsort(dists)
for ind in inds:
    axs[0].plot(data[ind]['Freq'], data[ind]['ZcPhase'], label=str(round(data[ind]['dist']))+' um')
axs[0].set_title('Apical Trunk', fontsize=14)
axs[0].set_ylabel('Transfer Impedance Phase', fontsize=12)
axs[0].set_xlabel('Frequency (Hz)', fontsize=12)
axs[0].legend()
data = []
dists = []
for t in obliq:
    with open('imped_data/M1Cell_apic_' + str(t) + '.json', 'rb') as fileObj:
        tmp = json.load(fileObj)
    dists.append(tmp['dist'])
    data.append(tmp)
inds = np.argsort(dists)
for ind in inds:
    axs[1].plot(data[ind]['Freq'], data[ind]['ZcPhase'], label=str(round(data[ind]['dist']))+' um')
axs[1].set_title('Apical Oblique', fontsize=14)
axs[1].set_xlabel('Frequency (Hz)', fontsize=12)
axs[1].legend()

* [2021-12-13 Mon] - looking at Rich et al 2021 human cell 
** importing 
import os 
os.chdir('models/HumanCellOrganized_v2/')
from neuron import h
h.load_file('stdrun.hoc')
h.load_file('import3d.hoc')
h.load_file('SimulationParameters_PlusSomeDefinitions.hoc')
h.load_file('ModelSetup.hoc')
trunk_secs = [1,3,7,15,24,37,59,85,109,123,131,137,143,145,149,155]

* [2022-2-16 Wed] - suprathreshold/nonlinear phase 
** analog for linear phase - lag between peak of stimulus to somatic AP 
*** similar phase lead at low frequencies
*** seemingly opposite relationship between distance and "synchronous frequency"
*** suprathreshold phase response depends on amplitude / spike rates 
** M1Cell not working anymore 
** possible figs 
*** compare subthreshold to suprathreshold phase 
*** distance dependence 
*** amplitude dependence 
*** different holding currents  

* [2022-3-14 Mon] - phase precession and roll 
** phase roll paper 
*** [[https://paperpile.com/app/p/63a428b5-8425-0bb9-b995-f3c9caee4a5c][Sloin2022-pe]]
** phase roll with constant amplitude sinusoid, phase precession with ramped 
amplitude sinusoid 
** ramped sinusoid phase precession 
*** h-dependent 
*** location dependent 
*** frequency dependent?
*** amplitude / slope dependent?

* [2022-3-17 Thu] 
** DONE - put together basic figures for precession and roll 
** DONE - email kubie about how to frame for the phase precession people 

* [2022-4-7 Thu] - prelim findings fig for proposal 
** plot lag vs. stimulus cycle for ramp and constant chirp 
import json 
import numpy as np 
from matplotlib import pyplot as plt 
plt.ion()
with open('supra_data/HayCellMig_apic_0_amp_1.0_offset_0.0_f0_8_f1_8.json', 'rb') as fileObj:
    control = json.load(fileObj)
with open('supra_data/HayCellMig_apic_0_amp_1.0_offset_0.0_f0_8_f1_8_blockIh.json', 'rb') as fileObj:
    blockIh = json.load(fileObj)
fig, axs = plt.subplots(nrows=1, ncols=2)
axs[0].plot([i+1 for i in range(len(control['lags'])-1)], control['lags'][1:], 'b*-', label='Control')
axs[0].plot([i+1 for i in range(len(blockIh['lags'])-1)], blockIh['lags'][1:], 'r*-', label='Block Ih')
with open('ramp_data/HayCellMig_apic_0_amp_2.0_offset_0.0_f0_8_f1_8.json', 'rb') as fileObj:
    control = json.load(fileObj)
with open('ramp_data/HayCellMig_apic_0_amp_2.0_offset_0.0_f0_8_f1_8_blockIh.json', 'rb') as fileObj:
    blockIh = json.load(fileObj)
axs[1].plot([i+1 for i in range(len(control['lags']))], control['lags'], 'b*-', label='Control')
axs[1].plot([i+1 for i in range(len(blockIh['lags']))], blockIh['lags'], 'r*-', label='Block Ih')

* [2022-6-6 Mon] - getting back into it 
** using hilbert transform to extract phase angle, use angles rather than lags 

* [2022-6-7 Tue] - possible figures 
** 1. subthreshold vs suprathreshold, insufficiency of chirp 
** 2. just traces showing precession and roll 
** 3. precession - location-, amplitude-, frequency-, Ih-dependent 
*** maybe just perisomatic or apical for amp, freq, and Ih 
** 4. roll - location-, amplitude-, frequency-, Ih-dependent
*** same 
** 5. [if rapid report, get rid of 1.] - neuromodulation of precession/roll 

* [2022-6-9 Thu] - sims to run 
** const amplitude 
*** Perisomatic (apic_0)
**** 8Hz, 1.0 nA 
**** 4Hz, 0.56 nA 
*** Apical (apic_36)
**** 8Hz, 3.45 nA 
**** 4Hz, 2.26 nA 
** ramp amplitude 
*** Perisomatic (apic_0)
**** 8 Hz, 1.9 nA 
**** 4 Hz, 1.9 nA 
*** Apical (apic_36)
**** 8 Hz, 3.9 nA 
**** 4 Hz, 4.0 nA 

* [2022-6-23 Thu] - sfn abs, figs, vaidya stim protocol
** submitted abstract for sfn 
*** [[https://docs.google.com/document/d/18zPJFahz_G0opLqehJZI-OZaTqGrtxBP5aGvtcE1FnE/edit?usp=sharing][abstract]]
** decent figures for phase advance and retreat 
*** [[figures/supra_phase.svg][phase retreat (roll)]]
*** [[figures/supra_ramp_phase.svg][phase advance (precession)]]
**** TODO: change roll->retreat; precession->advance in titles 
** implementing stimulation paradigm from Vaidya2013-sx
*** alternating dendritic exc (4) and somatic inh (2) at 7 hz 
*** exc: tau 3, e=0mV, 2mv somatic EPSP 
*** inh: tau 8, e=-80mV, 3nS conductance 
*** so far, very square looking 

* paper outline 
** Introduction 
*** Overview of subthreshold impedance and chirp 
Impedance characterizes the frequency dependent filtering properties of the 
neuronal membrane for small, subthreshold stimul. 
Impedance has been estimated in neurons by applying current stimulus in the form 
of either a chirp (sinusoidal signal whose instantaneous frequency increases with
time) or white noise and recording the resulting changes in membrane potential.
The ratio of the Fourier transformed \vmemb to the Fourier transformed current 
stimulus is the impedance, which has a real part (impedance amplitude), which 
characterizes frequency dependent signal attenuation, and an imaginary part 
(impedance phase), which characterizes the temporal relationship between the 
input stimulus and \vmemb.
This method only holds when the neuronal membrane behaves as a linear, time-
invariant/stationary system (i.e. for small, subthreshold inputs).
Since the primary outputs of neurons are action potentials, which are nonlinear 
[and nonstationary], impedance is inadequate for studying much of neuronal function.
*** Methods for suprathreshold analogous to impedance amplitude 
**** STA 
Spike-triggered averaging was the first method to try bridging the gap between 
subthreshold membrane potential oscillations and suprathreshold activity Bryant1976-ek.
For instance, hippocampal pyramidal neurons showed Ih-dependent selectivity for 
theta-frequency inputs comparable to their subthreshold resonsance Das2017-tb.
**** suprathreshold chirp shows spiking aroung the resonance frequency, but not
for the lowest frequencies or higher frequencies, in line with the bandpass 
nature of the membrane filtering properties Ulrich2002-dd.
**** nonlinear, subthreshold Pena2019-qv
At higher, but still subthreshold, intensities of stimulating current, the responses 
to excitation and inhibition become assymetric (nonlinear).  
Pena2019-qv extend impedance amplitude framework to assess these nonlinear voltage 
responses in a conductance based model neuron.
**** suprathreshold 
Fischer2017-jx used suprathreshold sinusoidal stimuli with constant frequencies to 
assess the the frequency dependence of spiking patterns in mechano-sensory neurons 
in leeches.  
By stimulating at various frequencies and either counting total number of spikes or 
computing spike frequency over a given duration, they developed another nonlinear 
analog to impedance amplitude.
*** Our method for suprathreshold analogous to impedance phase 
While these methods provide useful analogs to impedance amplitude for nonlinear 
regimes of neural activity, they ignore the temporal relationship between input 
and output captured by impedance phase in the subthreshold, linear regime.
To fill this gap, we stimulated a model neuron with suprathreshold sinusoidal 
current signals and registered the phase angles of the stimulus at which action 
potentials occurred. 
We found that for constant amplitude, sinusoidal currents of constant frequency, 
the stimulus phase at which an action potential was generated increased with 
successive stimulus cycles. We refer to this phenomemon as phase advance.
Conversely, for sinusoidal currents of constant frequency whose amplitude increased
over time, the stimulus phase at which an action potential was generated decreased
with successive stimulus cycles.  We refer to this as phase retreat.
Both scenarios serve to highlight the nonstationarity of the neuron in the nonlinear 
spiking regime of activity.
** Methods 
*** explanation of cell model, previous results for subthreshold 
**** Modified version of neocortical layer 5b pyramidal neuron from Hay2011-if 
which incorporates a combination of Ih and TASK-like shunting current described 
in Migliore2012-ev.
**** constant HCN channel density in the basal dendrites, exponentially increasing 
density with distance from the soma in apical dendrites.
**** This model was shown in Kelley2021-hr to have location-dependent, subthreshold 
impedance amplitude and, importantly, phase profiles in close agreement with 
experimental observations.  [In most other models of L5b PYR neurons, either the 
phase or amplitude profiles agreed with experiments, but usually not both].
**** more description from original paper . . . 
*** overview of stimulation paradigms 
**** chirp stimuli
When using a chirp stimulus, the instantaneous frequency of the waveform increased 
linearly from 0.5-20 Hz over a 20s duration.  
When using a chirp stimulus to demonstrate the subthreshold impedance properties of
the neuron, we chose a stimulus amplitude that produced symmetrical changes in Vmmeb 
about Vrest.
For suprathreshold chirp stimulus, we chose an amplitude sufficient to produce one 
spike per stimulus cycle when the stimulus frequency <12 Hz.  In order to produce
spiking for higher frequency stimuli, the amplitude would need to increase, which 
would elicit more spikes at the lower frequencies.
**** sinusoids 
Becasue the responses to suprathreshold stimuli were clearly nonstationary, we 
focused on sinusoidal stimuli with constant freqeuncy.
***** constant ampltiude sine
First, we used stimuli with a constant amplitude, and that amplitude was chosen to
elicit a single spike on each cycle of the stimulus. At lower amplitudes the cell
may only spike on the first stimulus cycle, and at higher amplitudes the cell may 
produce multiple spikes per stimulus cycle.
We repeated this stimulation for frequencies 2-9 Hz to asses the frequency dependence 
of the spike phase relationship.  
We also assesed the amplitude-dependence of the spike phase relationship for stimuli 
of a particular frequency. 
Location-dependence was assesed by comparing stimulation in the soma versus stimulation
in the apical dendrite. 
We evaluated the influence of Ih by blocking HCN channels throughout the neuron.
***** ramped sinusoid 
We stimulated both the soma and the apical dendrite (~300 um from the soma).
Next, we used stimuli with an amplitude that increased linearly over time. Here,
the neuron did not spike during the first couple (smalled amplitude) stimulus 
cycles, but by the end of the stimulation the neuron produced one spike per stimulus 
cycle.
Unless otherwise noted, the amplitude of the stimulus increased 1nA/s. 
We similarly assesed the frequency-, amplitude-, location-, and Ih-dependence of the
spike-phase relationship for stimuli of increasing amplitude.
** Results 
*** inadequacy of chirp for suprathreshold phase, need for sinusoids
Chirp stimulation was inadequate to characterize the relationship between stimulus 
phase and spiking because spiking activity is nonstationary.
In response to a chirp stimulus, the stimulus phase angle of each spike increased
monotonically as the stimulus frequency increases from 0.5 to 6 Hz.
At the lowest frequencies, the spikes preceded the peaks of the stimulus cycles.
At ~4Hz, the spiking activity was coincident with the peak of the stimulus cycle.
At higher frequencies, the spikes lagged behind the peaks of the stimulus cycles.
This monotonic increase broke down beyond 6 Hz with large jumps in the spike-phase 
relationship as stimulus frequeny increased.
This breakdown suggested that spiking activity was nonstationary so we probed the 
spike-phase relationship for sinusoidal stimuli of constant frequency to show how 
it changed over time.
*** phase advance of spiking relative to stimulus 
For particular combinations of sinusoidal stimulus amplitude and frequency, 
spike-phase increased over the course of stimulation, a phenomenon we termed phase 
advance.  
We used an 8 Hz, 1 nA sinusoidal stimulus near the soma as an example of phase 
advance. 
The first spike initiated 20deg before the peak of the stimulus cycle. 
The phase of each spike increased over the next six cycles, with the seventh 
spike occuring 25deg after the peak of the stimulus cycle.   
After the eighth stimulus cycle, the relationship between spikes and stimulus phase
remained relatively constant.
Phase advance was location dependent.  When stimulating the apical dendrite rather
than perisomatically, the spike-phase curve shifted upward, with the first spike 
occuring ~10deg before the stimulus cycle peak and the curve saturing at ~35deg
after the stimulus cycle.
Phase advance was also dependent on Ih.  Blocking the HCN channels eliminated 
phase advance, with spikes alternating every other stimulus cycle, and after the 
first spike the relationship between stimulus phase an+d spiking remains constant 
for the duration of the stimulus.
Using 1 nA amplitude stimuli, we showed that phase advance is frequency dependent.
At that amplitude, phase advance was clear at 8 Hz but not at other frequencies.
It should be noted, however, that there can be strong phase advance at different 
frequencies for different stimulus amplitudes (data not shown).
We also showed that for an 8 Hz stimulus, the spike-phase relationship changed with 
different stimulus amplitudes. Interestingly, the spike-phase curve did not change 
smoothly as the stimulus amplitude changed.
*** phase retreat of spiking relative to stimulus 
We also stimulated the neuron with sinusoidal current stimuli whose amplitude
increased linearly with time.  
For specific combinations of stimulus freqeuncyy and amplitude sweep, spike-phase 
decreased over the course of stimulation, a phenomemon we termed phase retreat. 
When stimulating the neuron near the soma with an 8 Hz stimulus whose amplitude 
increased by 1.9 nA/s, the first spike occurred ~25deg after the peak of the stimulus 
cycle, and spike-phase decreased until the fifth spike, which occurred ~30 deg 
before the peak of the stimulus cycle.  
Phase retreat was location dependent.  When stimulating the apical dendrite, 
rather than perisomatically, the spike-phase curve shifted upward, with the 
first spike occurrent ~55deg before the stimulus cycle peak. 
Spike-phase decreased with successive stimulus cycles, with the tenth spike 
occurring 20deg after the stimulus cycle peak.
Phase retreat was modulated, but not dependent on, Ih. Blocking HCN channels 
resulted in an upward shift in the spike-phase curve and a smaller range of 
stimulus spike-phases.
Phase retreat was dependent on stimulus frequency.  For a stimulus whose amplitude 
increased by 1.9 nA/s, the greatest degree of phase-retreat occurred for an 8 Hz 
stimulus, with either less phase retreat or spike-phase not decreasing monotonically
for stimuli of other frequencies. For other amplitudes, however, monotonic phase 
retreat occurred at other frequencies.
*** neuromodulation 
**** Can modulate the spike-phase curve via normodulation of Ih
**** Phase advance: Decreasing vhalfl shifts curve, shift 
curve upward (later spikes) beyond second spike/stim cycle. However, vhalfl=-91 produced later spike 
phase than baseline, but vhalfl=-92 produced an earlier spike than at baseline.
Increasing vhalfl conversely shifted the spike-phase curve downward (earlier spikes)
**** Phase retreat: same trend without first spike weirdness at vhalfl=-92
** Discussion 
*** recap and interpret results 
*** sinusoidal currents as models of rhythmic alternation of synaptic 
excitation and inhibition Vaidya2013-sx
*** modeling shows HCN regulates spike phase relative to LFP Sinha2015-lz
*** possible implications for phase precession and phase roll Sloin2022-pe 

* [2022-7-11 Mon] - TODOS 
** DONE: finalize figure 1 
*** current version [[figures/chirp_insufficiency.png][3 rows of panels, sub chirp, supra chirp, supra single freq]]]
*** alt: put stimulus traces on same axes as response 
*** alt: remove single freq stim figure, move to separate fig with traces for both retreat and advance
**** could also add traces to retreat and advance figs 
** DONE: address (or decide whether to address) neuromodulation 
*** look at Maki-Marttunen2022-lj or talk to joao and salva re reasonable values of vhalf   

* [2022-7-14 Thu] - neuromodulation
** increasing vhalfl for hcn reduces amplitude "threshold" and seems to increase 
phase advance, takes longer to "latch"
*** see supra_data/HayCellMig_soma_0_amp_0.6_offset_0.0_f0_8_f1_8_vhalfl_-80.json
 
* [2022-7-15 Fri] - more neuromodulation 
** from Maki-Marttunen2022-lj review re neuromdolator concentrations 
2. Concentrations of ACh and dopamine
In the referenced studies, the modulations of voltage dependency were performed by either
controlling intracellular cAMP through a glass pipette during the patch-clamp recording or by
the perfusion of the antagonist in the extracellular solution. The concentration of
neuromodulators reported by the submitting authors is likely beyond the physiological
operating range of cortical neurons reported previously.
For example, Hironaka et al. (2001) reported that the ACh concentration in the rat prefrontal
cortex ranged from 10 nM to 30 nM (PMID: 11368961). On the other hand, the dose of ACh
used in the referenced work (Zhao et al., 2016) used 50 μM of ACh. Additionally, Spühler
and Hauri (2013) developed a simulation allowing in silico estimation of dopamine
concentrations in prefrontal cortex (PMID: 23951205). Spühler and Hauri found that the
concentration of dopamine in the prefrontal cortex likely falls between 9.5 nM to 250 nM in
the steady state and 23.4 nM to 989 nM with 26 Hz phasic dopamine release. The submitting
authors instead refer to Byczkowicz et al. (2019), which used 200 μM of dopamine in their
study.
Zhao et al. (2016) and Byczkowicz et al. (2019) used doses of Ach and Dopamine,
respectively, that are more than 200 times high than what was previously reported as possible
in vivo. These doses may represent a non-physiological perturbation that are not ideal for a
simulation that attempts to reconstruct normal, physiological spiking activity.
The submitting authors need to adjust the effects of neuromodulators based on physiological
concentrations. If they find similar results as to what was reported here, then it’s interesting.
We thank the reviewer for this comment. There are indeed at least two ways of
experimentally studying the effects of cAMP-coupled neuromodulators on I h activation:
either applying the neuromodulator (or corresponding agonist) to the extracellular medium, or
directly applying cAMP (or cAMP pathway inhibitor) into the intracellular medium. Apart
from Zhao et al. 2016, all our references use the latter approach (although, as noted by thereviewer, Byczkowicz et al. also applied dopamine in a related experiment; and Zhao et al.
also find similar results using the latter approach) but similar magnitudes for voltage shifts
have been reported using the former approach. For example., Wu and Hablitz 2005
(PMC6725283) reported a depolarizing shift of the half-inactivation voltage of 7 mV by
application of 30 uM dopamine, while our references found shifts ranging from 4 to 17 mV
by increased intracellular cAMP. We now mention this on p. 18:
It should be noted that although the above data and the data on HCN2-channel modulation
[Byczkowicz et al., 2019] were based on measured effects of direct increase of intracellular
cAMP, voltage shifts of similar magnitude have been observed when dopamine was applied
in the extracellular medium (e.g., 30 μM dopamine shifted the half-inactivation voltage of I h
currents in layer I interneurons by +7 mV in [Wu and Hablitz, 2005]).
As for the neuromodulator concentrations used in our references, it is true that ACh
concentrations measured in the extracellular medium in vivo are within the nanomolar range
(as shown in e.g. Hironaka et al. 2001 mentioned by the reviewer), which is much smaller
than the in vitro experiment of Zhao et al., 2016. However, one should keep in mind that, in
vivo, the local, transient concentrations of ACh are much higher in the synaptic cleft and
other confined volumes near the post-synaptic neuron’s dendrites than the measured global
concentrations in the extracellular medium. In Barberis et al. 2011 (PMC3123770), it was
estimated that an ejection of 4000 GABA molecules implies a concentration pulse of
hundreds of 𝜇M in the synaptic cleft. Similar estimates were made for ACh in Aidoo, A. Y.,
& Ward, K. (2006), Mathematical and computer modelling, 44(9-10), 952-962. By contrast, a
neurotransmitter concentration of a nanomolar magnitude in the synaptic cleft would
correspond to a handful of neurotransmitter molecules. Thus, we do not consider the bath
concentrations used in our references exaggeratingly large (especially since the experiments
that directly altered intracellular cAMP concentrations yielded similar ranges of voltage
shifts), although we agree with the reviewer that further research with varied concentrations
would be enlightening.
To show the relevance of the chosen range of voltage shifts, we have included references to
additional experiments supporting our use of 5-10 mV shifts, namely Chen et al. 2001
(mentioned by the reviewer), Ulens and Tytgat 2001, Ludwig et al. 1998, Wang et al. 2001,
Ko et al. 2016 – see our response above. To further highlight the fact that smaller
neuromodulator concentrations can lead to large effects, we also refer to a study where 10 uM
serotonin application had significant effects on L5PC excitability, mediated by I h current. In
addition to the sentences added in response to the comment above, on p. 17 we write:
Moreover, similar to cholinergic M2 receptors, serotonergic 5HT1A receptors (Gi/o coupled)
shift the half-inactivation voltage of Ih currents toward hyperpolarized potentials [Ko et al.,
2016], and these receptors mediated an inhibitory net effect in a subgroup of prefrontal
cortical L5PCs [Elliott et al., 2018].
To discuss the future directions for detailed modelling of I h channels, we now write on p. 22:
Furthermore, modelling of intracellular cAMP concentration and its effects on the I h
activation would be beneficial since the concentration of cAMP varies across dendrites [Katz
and Clemens, 2001], and thus I h channels in one part of the dendritic tree may be more prone
to negative cAMP modulation and others to positive one.
** nice results for altering vhalfl for both advance and retreat 
** probably want to user smaller slope for ramped sine / phase retreat figures 

* [2022-7-17 Sun] - neuromodulation figure  

* [2022-7-22 Fri] - starting paper 
** started paper on overleaf 

* [2022-8-3 Wed] - paper notes 
** Kamondi1998-rd
*** used two compartment (soma and dendrite) model of CA1 pyramidal cell without ih 
from Pinsky1994-fy
*** stimulated dendrite and soma with sinusoidal currents and observed "spike phase precession"
*** "To mimic the passage of a rat across the place field, let us suppose that 
the excitatory drive to the neuron's dendrite is gradually increased as the rat 
enters and moves across the place field."

* [2022-8-18 Thu] - focusing on apical stim for phase retreat 
** reasoning:
*** more dramatic drop in spike-phase over cycles 
*** clearly monotonic decrease 
*** no doublets, will look better (and consistent) for the trace 
*** more clear amplitude dependence 
*** follows more closely from buzsaki paper 

* [2022-9-15 Thu] - synaptic stims 
** still looks ugly, but got something that looks like phase retreat w/ ff inhibition 
*** excitatory 
oblq_secs = [9, 87, 105, 19]#, 101]
gmaxs = [0.01*12, 0.004*12, 0.0027*12, 0.006*12]#, 0.0038/4]
*** inhibitory
peri_secs = [0, 7]
inh_syns[sec_num][-1].gmax = 0.003 * 50 
** very hard to oscillations symmetrical about vmemb

* [2022-9-21 Wed] - asym phase and synaptic stims 
** adapted framework from Pena et al for asymmetric impedance amplitude for 
asymetric impedance phase
*** clear differences between upper envelope and lower envelope 
*** can use for spiking activity 
** synaptic stims 
*** tried sampling gmax for AMPA and GABA synapses from sinusoid - very tricky 
*** trying alternating excitatory and inhibitory Exp2Syn - still very tricky 
**** weights need to be asymmetric for symmetric voltage excursions 
**** not sure what the point is if synapses are so highly contrived (trying to get 
as close to sin as possible)

* [2022-9-26 Mon] - nonlinear phase computations 
** new fig - comparison of of linear to nonlinear phase, amplitude/asymmetry 
dependence, holding voltage dependence, h-current dependence, location dependence 

* [2022-10-3 Mon] - back to manuscript 
** email people with nonlinear responses?

* [2022-10-21 Fri] - rewriting results 
** questions for bill:
*** why sychrony point?  anything wrong with synchronous  frequency?  it's what we used in the last paper 

* [2022-10-25 Tue] - channel conductances 
** recording channel conductances at soma for subthreshold asym responses fig 
*** doesn't really make sense for comparison between somatic and apical stim 
where to record? 
** bill's alternative: graph amplitude sensitivity against tau for m,h for each ?
*** /usr/site/nrniv/local/python/mhn.py 
**** doesn't work on neurosim or locally, problem w/ h.usetables, seg fault if comment out 
**** just an idea;tau is a voltage-sensitive param that defines a response time for that channel

* [2022-12-12 Mon] - exp data 
** scipt for analyzing traces from sheets paper: *analyzeExpData.py*
*** pulled data from webplotdigitizer

* [2023-1-2 Mon] - fixing up phase advance 
** bill's comments 
*** 6D doesn't make sense to me -- assuming that we are starting at the same amplitude 
why no spike on 1st cycle ... ah ic half-cycle now too short at higher freq -- 
ok i'll put that explanation in and we can correct it later if that's wrong
*** 2:54 oh but more questions -- in fig4 we appear to be counting cycles from 0 but in 
6 counting from 1 ??
oh presumably both start at 0 but no spiking in fig6 ;  we need to give indication 
of what starting point amplitude is -- prob you do in methods; lms ..   just says 
"The neuron did not spike during the first few (smallest amplitude) stimulus  
cycles,"  so in fig4 is 1nA so fig6 starts at ?0.8?? (just guessing) (edited)
billl
**** edited methods - "Unless otherwise noted, the amplitude of the stimulus started at 0 nA and continuously increased 0.65 nA/s."
***  3:23 PM oh but that doesn't seem right eitehr since fig6A shows a spike on 0th cycle
**** did not include non-spiking cycles in the trace figure, since wouldn't be able to see phase shift of spiking
added to caption - "Traces start at fifth stimulus cycle.  The cell did not spike on earlier cycles."
** rerunning ramp data at soma

* [2023-1-24 Tue] - srdjan's comments 
** "a non-physiological linear, time-invariant/stationary system" - I am not sure 
about your meaning of "time-invariant". Publications cited in the previous 
sentence use CHIRP stimulus. Chirp stimulus is changing with time, hence it is NOT 
time-invariant
*** It is not the chirp signal which must be time-invariant, but the system (in this
context, the neuronal membrane).  This is standard lingo in control theory, and means 
that the response (or more precisely, the transfer function) of the system does not 
change over time.  For instance, a 4 Hz stimulus should cause the same response at 
noon and midnight, or alternatively, it should respond the same whether you stimulate 
for a minute or an hour.
*** To more explicitly explain these terms, changed first sentence to:
Impedance analysis assumes a linear, time-invariant system. In a neural context, 
this implies that positive and negative current stimuli of equivalent amplitude produce equal and opposite 
changes in \vmemb\ (linearity) and the neuron always has the same response to 
equivalent inputs (time-invariance). Impedance analysis is therefore ill-suited for 
studying much of neuronal function, which is decidedly nonlinear and 
time-varying \citep{Rotstein2014-bt}.

**  "We found nonlinear subthreshold Vmemb responses to chirp stimuli maintained 
different frequency-dependent phase relationships depolarization and 
hyperpolarization" - Bad sentence. I am unable to understand the grammar of the sentence.
*** Meant to be: We found nonlinear subthreshold \vmemb\ responses to chirp stimuli maintained 
different frequency-dependent phase relationships during depolarization and
hyperpolarization.
*** Possible rewrite:
We found that the depolarizing and hyperpolarizing half-cycles of nonlinear 
subthreshold \vmemb\ responses and the high-amplitude chirp stimuli that elicited 
them maintained different frequency-dependent phase relationships.

** "I understand that Fi-Plus is important for temporal coding, specifically phase coding. 
I cannot justify your idea to calculate phase shifts for the hyperpolarizing deflections. 
How is Fi-minus related to physiology? Is there any experiment carried out on real 
neurons showing that Fi-minus is used by the brain?"

** “This will dictate the time-course of large IPSPs in the same way Fi-plus will 
dictate the time-course of large EPSPs, and Fi (impedance phase for linear system) 
dictates time-course of small signals”. 
I am not aware of large IPSPs in L5b pyramidal cells.
In this cell type, the power of inhibition is in the current shunting – powerful 
inhibition without any substantial voltage change.
In few cases when IPSPs do produce small negative potentials, their time course 
(rising phase) is relatively slow; slower than the rising phase of an AP, for 
example. The IPSP peak is round – the peak is not as clear as the AP peak. Hence, 
the phase shift of 1 or 2 ms is likely irrelevant for IPSPs, but it may still be 
relevant for APs, unless of course you can prove otherwise.
*** I partly think the physiological relevance of Phi-minus in L5b Pyr neurons is 
itself irrelevant. I'm using the cell model as much (if not more) to showcase the 
method than to explore the physiology of this cell type. I'm using this specific 
cell because the linear impedance profiles were in close agreement with experiment  
(last paper), so we might as well use it to study the nonlinear case.

**  “What Fi-minus describes is the phase shifts between oscillatory stimuli and 
hyperpolarized Vmemb responses when the stimuli produce nonlinear/asymmetric Vmemb”. 
I think that Fi-minus describes the phase shifts between oscillatory stimuli and 
hyperpolarized Vmemb responses regardless of whether the response is linear or 
nonlinear. Correct me if I am wrong.
*** this is correct, Phi-minus will describe the phase shift regardless of whether
Vmember response was linear or nonlinear.  However, classical/traditional impedance 
phase will not characterize that phase shift (or that of the depolarized response)
when vmemb response is nonlinear. 

** The term "compound" is often used in neurophysiology to indicate signals from 
many cells combined onto one detector/electrode. 

** Sorry, when is voltage high enough to activate voltage-sensitive ion channels? 
Are all channel species activated at that voltage you have in mind? Specify here 
(in the results section) the list of channels activated at this higher amplitude 
regiment. You can potentially use some arbitrary threshols, for example 10% of 
maximal conductance (g_bar) was opened, therefore we consider the channel to be 
“activated”. Specify the list of channels that you had in the model cells but were 
not activated significantly, less than 10% of maximal conductance (g_bar). 
*** I think some, but not all, of this gets addressed as we move through the results,
partly as the relevant conductances change depending on the stimulation paradigm 

** "We observed a notable change in phase shift between spikes and stimulus over time 
(Fig. 2D)." "Time" is not the main variable here. In Fig. 2, perhaps a more important 
variable is the "instantaneous FREQUENCY" of the chirp stimulus. 
*** I partly disagree, with a slew rate of 1 Hz/s, instantaneous frequency changes 
very little over three cycles ~8 Hz.

** I do not see any signs of “phenomenological inductance” in Fig. 3. If you expect 
the readers to solve a detective story, this is a bad idea. You should write for high 
school students, and you should write for me (Srdjan Antic). I have no idea what 
phenomenological inductance is, or what it means to you personally. The writer 
(Kelley) and the reader (Antic) have to come to some common grounds, before we 
jump into the essence of the finding. Please show “inductance” in figure or define 
it here with words. 2-3 sentences is not too much wording for introducing the central 
point of the paper. 
*** needs to be defined earlier. 

** I do not see this in the figure. I do not see peak response being 5% higher 
than through. Is this a detective story?
I do not see how your results led you to conclude that Fig. 3A is due to Na channels.

** Dendrites - I thought you should open this next paragraph with an announcement: 
Hey, inputs are received on dendrites”. It is possible that current injection in 
the cell body (Figs 2 and 3) is not the same thing as current injection into 
dendrite (Reference). The location of input may affect the neuronal I-O. Now we are
going to investigate this question by placing the current injection site on denrite 
while still recoding axonal APs from the cell body.

** What caused changes in RMP? Did the I-h channel block produce a change in RMP, 
or did you artificially set RMP to more hyperpolarized levels? Why are you not 
disclosing these details and helping thousands of readers. 
*** maybe we're not using the right term here.  holding?

**  I have no idea what “classical impedance phase” means to you – please put it 
in a figure for direct side-by-side cpmarision
*** it is in figure 2, will make sure to call it that earlier 

** I do not see Ih and Ina effects in Fig. 3D.

** It is not clear why you decided to emphasize green lines? Upon observation of 
Fig. 3D, I conclude that large amplitude and small amplitude stimuli, both produce 
qualitatively identical results, same slope of the curve, same intersection, same 
general shape. What is going on here? 

** Are you saying that your model keeps track of intracellular Ca? If you block all 
Ca channels, does activation of SK channel decrease to zero?  

**  L5 pyramidal cells can fire APs at 150 Hz. What do you mean, at 9 Hz the cell 
could not follow?

**  I do not see any evidence that I/O phase relationships were dependent on the 
phenomenological inductance. Could you please elaborate?
*** same issue as above, phenom inductance needs explanation 

** (what complicated behavior, could you please elaborate your ideas). I am totally 
confused. Complicated behavior resulted from spiking, except Na channels were 
blocked in Fig. 2C? Also, the behavior was complicated, but the I/O phase relationship 
changed smoothly with frequency?
*** no spiking, smooth; with spiking, not 

**  This is perfectly logical and predictable from the basic Physiology. Stronger 
inputs charge neuronal membrane faster than weaker inputs. Faster charging curve 
activates Na channels more potently bringing a neuron to firing threshold sooner. 
Hence, the stronger the stimulus, the sooner will neuron fire. Note that activation 
dynamics of channels did not change. The only thing that changes is stimulus 
intensity. The idea that stimulus intensity is coded by time (phase shift) is at 
the core of the phase coding theory (Wolf Singer, Pascal Fries). Within an 
oscillation cycle, the amplitude of an excitatory input to a CNS neuron is 
converted into a temporal code. The amplitude of excitation is recoded in the 
time of occurrence of the recipient neuron’s output spikes, relative to the phase 
of the oscillation cycle. Here, stronger inputs lead to earlier responses. Thus, 
amplitude values are converted into phase-shift values that indicate by how much 
a discharge precedes the peak of a gamma cycle. Perhaps you wish to cite 
Dr. Wolf Singer and the gang?

** Why is K+ channel SK important and the following two K+ channels are not 
important: [1] Delayed rectifier K channel [2] M-type K current. Also, why 
is K+ channel SK important and the low-threshold T-Type Ca channels are not 
important?

** Which mechanism [for phase advance]? Is it a gradual increase in stimulus 
intensisity? State explicitly.

** All biological examples (citations) you came up with, to discuss the functional 
implications, are examples from hippocampus. However, you had chosen to model 
membrane properties and membrane currents of a neocortical layer 5b (L5b) 
pyramidal neuron. A solid reviewer would say: “Hey Dr. Kelley, CA1 pyramidal 
cells are different from L5b pyramidal cells. Take a model of a CA1 pyramidal cell 
and test your current results on the phase retreat and phase advance; do they hold 
in CA1 cell, and what are the qualitative and quantitative differences between the 
phase-retreat dynamics in cortical L5 versus that in hippocampal CA1?

** A reviewer could ask: “Hey Dr. Kelley, which brain area is your L5b cell from? 
Is it barrel cortex, auditory cortex, visual cortex, entorhinal cortex, motor 
cortex or prefrontal cortex? Is this cortico-cortical (CC) or cortico-subcortical 
(CS) subtype?”

** All of your biological examples on functional implications are examples from 
hippocampus. Here is one possible relief from cortex: Hafting T, Fyhn M, Bonnevie 
T, Moser MB, Moser EI (June 2008). "Hippocampus-independent phase precession in 
entorhinal grid cells". Nature. 453 (7199): 1248–52. It may deflect my critique 
on the list of citations used in the discussion section.

** A reviewer could ask: “Hey, why did you present Fi-Minus data in the Results 
Section, if you never mentioned it in the Discussion Section?” Which brings us 
to my earlier point: I am not sure whether phase precessions for hyperpolarizing 
potentials are biologically relevant.

* [2023-2-9 Thu] - papers 
** Fries2009-nb - gamma band synchronization, doesn't seem relevant 
** Fries2015-kg - communication through coherence, bill keen on, need to read 
** Fries2007-zs - the gamma cycle, seems most relevant, refers to phase precession
*** the amplitude of excitatory drive is recoded into phase values of discharges 
relative to the gamma cycle. 
**** doesn't seem to have mechanism by which phase changes stop or can be modulated 
*** they cite Harris2002-fb and Mehta2002-uu as similar version in hippocampus 
** Engel2001-sy - dynamic predictions: oscillations and synchrony IN top-down processing 
*** Coherence among subthreshold membrane potential fluctuations could be exploited to express 
selective functional relationships during states of expectancy or attention, and these dynamic 
patterns could allow the grouping and selection of distributed neuronal responses for further 
processing.
*** The fact that synchrony is readily observed in multisite recordings of ongoing 
LFP signals (FIG. 1) indicates that substantial coherence must be present in 
subthreshold membrane potential fluctuations of different neurons. Such field 
potentials reflect the average transmembrane currents in a volume around the 
electrode tip, and therefore provide a measure mainly of postsynaptic dendritic 
responses. Direct evidence for coherence between subthreshold fluctuations of 
separate neurons has been obtained by Lampl et al.90, who recorded intracellularly 
from pairs of visual cortical neurons in vivo in the cat. They observed, in nearly 
all recorded pairs, strong synchronization of the ongoing fluctuations in the 
cells' membrane potentials. The features of this subthreshold synchrony are very 
similar to those of synchrony between ongoing spike discharges88, both occuring 
mostly with zero phase lag, and showing a clear dependence on the topographic 
proximity of receptive fields and the similarity of receptive field types. As we 
suggest below, coordinated subthreshold excitability changes could be important 
for specific 'priming' of the local network to particular input constellations, 
and so implement predictions resulting from top-down processing
*** need to reread, don't really understand how above is the case 
** Singer2009-vs - distributed processing, need to read 
** Schroeder2009-ca - low frequency oscillations instrument of sensory selection 
** Lakatos2007-ww - oscillations multisensory interaction 
** Barczak2019-dl - modulation of cortical excitability during active sensing  

* [2023-2-10 Fri] - paragraph for background 
Rhythmic activity is ubiquitous in cortical structures of the brain, and can be measured as oscillations  in the local field potentials (LFPs) recorded extracellularly.  
LFPs are in large part generated by the generated by transmembrane currents, principally postsynaptic dendritic currents, in neurons near the recording  electrode \citep{Engel2001-sy, Buzsaki2012-ga}, 
and recent work has shown pyramidal neurons to be the largest contributors to these rhythms \citep{Dura-Bernal2022-iw}.  
Pyramidal neurons have diverse biophysics and projections, and they form the main outputs of cortical circuits \citep{Aronoff2010-do, Harris2015-te, Hattox2007-km}. 
Therefore, understanding how pyramidal neurons integrate oscillatory synaptic inputs to generate subthreshold membrane potential oscillations and spiking activity is critical to understanding cortical computations.
Impedance analysis provides a tool for characterizing how the neuronal membrane responds and filters oscillatory inputs.

* [2023-2-14 Tue] - prep for pnas 
** current word count: 5473
*** "preferred length" for PNAS: 6 pgs, 4k words, 4 figures 

* [2023-3-7 Tue] - john's comments 
** rewrite 
Impedance analysis assumes that the neuronal membrane is a linear, time-invariant system.
Linearity implies that positive and negative current stimuli of equivalent amplitude produce equal and opposite changes in \vmemb\.
If the neuron were a linear system, there would be negative, hyperpolarizing action potentials.
Nonlinearity in the neuronal membrane arises through voltage-gate ion channels, whose conductances are different during depolarization and hyperpolarization.
Time-invariance implies the membrane always has the same response to equivalent inputs, but mechanisms like slow channel kinetics, \ca\ accumulation, and neuromodulation produce time-variance.
Impedance analysis is therefore ill-suited for studying much of neuronal function, which is decidedly nonlinear and time-varying \citep{Miller1985-xl, Rotstein2014-bt}.
The impedance analysis framework derives from electrical engineering and is based on linear resistor-capacitor-inductor (RLC) circuits. 
In a neural context, impedance analysis is used to characterize filtering properties of the membrane in a low-amplitude regime where nonlinearities can be approximated as ``phenomenological inductance'' \citep{Cole1941-vd, Mauro1970-km}. 
Neuronal membrane impedance is estimated by applying current as either a chirp (time-varying signal whose instantaneous frequency increases with time \citep{Puil1986-uv}) or white noise \citep{Moore1985-kg, Wright1996-pl} and recording the resulting changes in \vmemb.
Impedance is expressed as a complex number from which we can extract amplitude ($|Z|$), characterizing the 
frequency-dependent output strength, and phase ($\Phi$), characterizing frequency-dependent phase-shifts between input stimulus and \vmemb.
Because these methods properly pertain to a non-physiological, linear, time-invariant/stationary system, 
new methods are needed for characterizing the nonlinear filtering properties of the neuronal membrane, whether spiking or subthreshold.
** title 
Simulation of neuronal responses to oscillatory inputs demonstrates different phase
shifts for excitation and inhibition and nonstationary spiking patterns

* [2023-3-27 Mon] - supp fig 
** plotting 
from matplotlib import pyplot as plt 
import json 
import numpy as np
with open('sub_data/HayCellMig_apic_0_amp_0.025_offset_0.0_f0_0_f1_12.json', 'rb') as fileObj:
    chirp_data = json.load(fileObj)
with open('asym_data/HayCellMig_apic_0_amp_0.4_offset_0.0_f0_0_f1_13.json', 'rb') as fileObj:
    asym_data = json.load(fileObj)
plt.ion()
plt.figure()
# plt.plot(chirp_data['Freq'], chirp_data['ZinAmp'], 'k')
plt.plot(asym_data['f_minus'], asym_data['z_minus'], 'b')
plt.plot(asym_data['f_plus'], asym_data['z_plus'], 'b--')
plt.xlim(0,12)
plt.xlabel('Frequency (Hz)', fontsize=16)
plt.ylabel('Impedance Amplitude (M$\Omega$)', fontsize=16)
# plt.plot([chirp_data['Freq'][np.argmax(chirp_data['ZinAmp'])], chirp_data['Freq'][np.argmax(chirp_data['ZinAmp'])]], [0, np.max(chirp_data['ZinAmp'])], 'k:')
plt.plot([asym_data['f_minus'][np.argmax(asym_data['z_minus'])], asym_data['f_minus'][np.argmax(asym_data['z_minus'])]], [0, np.max(asym_data['z_minus'])], 'b:')
plt.plot([asym_data['f_plus'][np.argmax(asym_data['z_plus'])], asym_data['f_plus'][np.argmax(asym_data['z_plus'])]], [0, np.max(asym_data['z_plus'])], 'b:')

* [2023-5-15 Mon] - reviewer comments 
** Reviewer #1 (Comments to the Author (Required)):
*** This is a modeling paper that explores the complex dynamical response of a 
physiological model of cortical neurons. The paper identifies some interesting 
responses that might have real relevance to in vivo testing, and could lead to 
interesting new experiments. Specifically, standard methods of recording impedance 
or chirp responses would be unable to recognize changes in firing phase over 
successive periods, which might have relevance to several physiological phenomena. 
However, the format of the paper is a little unclear about the goals of this work 
and how they relate to prior methods. This should be clarified to make it more 
obvious what the goals of this paper are.

*** The model description only mentions Ih channels specifically I assume there were 
other channels as well. Please describe them. (Iahp is casually introduced all 
the way in Fig. 4, and "voltage sensitive sodium channels" are also mentioned 
without explanation. SK is introduced at the end of page 9). Even if this is 
referencing a past paper, a few more details of that model should be provided 
(i.e. all channels present and how distributed, at the very least)
**** see below 

*** Ih and Iahp are the main channels investigated. Is there a clinical relevance 
to these specific channels and the effects explored?
**** Ih in fragile x (johnston) and epilepsy

*** As the authors state, "traditionally, impedance measures...relied on low-
amplitude signals below the thresholds for activation of most voltage-sensitive 
ion channels." The obvious reason for this is that doing so is testing the 
impedance of the membrane (which is essentially a complicated RC circuit) without 
the ion channels. Certainly, the true neuronal responses are much more complicated 
once ion channels are invoked, so the rationale for testing these types of inputs 
is strong. But the title/abstract/paper are not clear as to what they are 
promoting. Is the goal of the paper to show that impedance and chirp are both 
insufficient to characterize these findings? Are they advocating for using this 
type of sinusoidal response of ranges of pertinent frequencies? My impression 
(which is not well stated in the paper) is that the main prediction here is that 
they have devised a novel perturbation method, which uncovered some potentially 
interesting relationships for firing phase that might be relevant to in vivo 
testing. This should be made more clear.

*** In a similar vein, the discussion should be more direct about why this type 
of analysis might have practical implications?

*** Once spiking begins, any specific results are likely the result of the 
parameters of the spiking, not the input. For instance, bursting frequency and 
phase on which the spike occurs are going to be almost completely dependent on 
the refractory parameters of the spiking, not the sinusoidal stimulus. The 
specific results are almost certainly tied to the parameters of this specific 
model. Those results are not going to be generalizable. The paper should make it 
clear that they are not promoting these specific results (frequency, amplitude) 
in these cells, but rather that this type of effect can be uncovered with this 
novel perturbation method.

*** The explanation of the "phenomenological inductance" producing an effective 
LCR circuit that self-synchronizes to 4.5 Hz sounds like a good explanation of 
how these cells have a "resonant" frequency. Is that the mechanism in the prior 
papers, or is this a novel contribution of the current one? Please clarify. 
This should be mentioned, even if it was already described in past work. It was 
news to me, and an interesting phenomenon. It also motivates not using chirp 
stimuli, where this effect could not be investigated (which should be mentioned).

*** Fig 4C why was phase retreat location dependent? Did that match up with the 
location dependence of the channels?

*** Fig 4 D,E. The text mentions that dropped spikes with 9 Hz causes the 
discontinuities in D, but what about the discont in E (1 nA?) ?
**** similar situation.  added:
For lower amplitudes (0.9 nA), the cell could not follow, again producing dropped spikes with corresponding discontinuous phase relation.

*** Fig. 6. I am not sure how compelling it is that increasing the amplitude 
causes phase advance-can't this simply be explained due to amplitude threshold? 
The data in E, might be able to disprove this. Can you show that AP is not just 
firing at the same stimulus amplitude each time (i.e. that A1sin(t1) is not 
equal to A2sin(t2), where t2-t1 is the "advance")? If not, then the idea of phase 
advance is more of a gimmick of the method, rather than a physiological effect. 
(although in the discussion about phase precession, the authors imply this 
"gimmick" may actually be a physiological effect of "increased sensory input").

*** I do not see how these results show that "when stimuli are large, causing 
Vmemb to approach spike threshold, the representation...becomes undemocratic". 
Proving that would have required simulating a multitude of IPSP and EPSP, which 
was not done here. Instead, this is a large stimulus applied to the whole cell, 
which in this metaphor seems more of a dictatorship than a democracy.
**** need to introduce total inductive phase to explain relationship between these 
results and synaptic potentials 
**** original 
Phenomenological inductance serves to compensate for delays in \vmemb\ changes caused 
by membrane capacitance \citep{Kelley2021-hr, Vaidya2013-sx}, 
and our results show that this compensation will be augmented for large inhibitory 
inputs and diminished for large excitatory inputs compared to smaller amplitude 
inputs that remain in the linear regime. 
Vaidya et al (2013) posited that the phenomenological inductance generated by 
gradients of \ih\ along the dendrites ensure synchronous synaptic stimuli are 
simultaneously integrated at the soma, regardless of the synapse location -- 
a ``democracy of synapses'' \citep{Vaidya2013-sx}.
Our results suggest that when stimuli are large, causing \vmemb\ to approach 
spike threshold, the representation of excitatory and inhibitory stimuli 
becomes undemocratic.
**** revised 
Phenomenological inductance serves to compensate for delays in \vmemb\ changes caused 
by membrane capacitance \citep{Kelley2021-hr, Vaidya2013-sx}, 
and our results show that this compensation will be augmented for large inhibitory 
inputs and diminished for large excitatory inputs compared to smaller amplitude 
inputs that remain in the linear regime. 
Vaidya et al (2013) observed increased phenomenological inductance with increasing 
distance from the soma along the apical dendrite in accordance with the increasing 
density of HCN channel expression.
Thus, there was more inductive compensation for capacitive delays for stimuli distal 
from the soma compared to those proximal.
Vaidya et al (2013) posited that the increasing phenomenological inductance with 
distance from the soma would ensure synchronous synaptic stimuli are 
simultaneously integrated at the soma, regardless of the synapse location -- 
a ``democracy of synapses'' \citep{Vaidya2013-sx}.
Due to the differences in phenomenological inductance for excitation and inhibition,
and the increased differences in phenomenological inductance with increased distance 
from the soma, our results suggest that integration of large amplitude stimuli will be undemocratic.

** Reviewer #2 (Comments to the Author (Required)):

*** The presence of various voltage-gated ion channels results in an asymmetric 
Vm impedance profile to the same amplitude depolarizing and hyperpolarizing 
inputs. Although this phenomenon has been documented previously, the analytical 
frameworks to capture such Vm non-linearities have only emerged recently.

In this manuscript titled: "Membrane potential phase shifts differ for excitation 
vs. inhibition in resonant pyramidal neurons: a computer modeling study", 
Kelley et al. develop an impedance phase analysis method to capture non-linear 
and nonstationary membrane potential responses to depolarizing and hyperpolarizing 
currents. Based on these analyses, they also explore the physiological implications 
of their findings.

However, the methodological innovation of this study is offset by the poor 
physiological implementation of the model that lacks several key ionic currents 
whose interactions shape membrane potential trajectories and result in the 
observed nonlinearity in the system.

*** The Methods section is not self-sufficient. The model construction/implementation 
is not described to the appropriate level of detail to understand the rest of the 
manuscript. The reader is left to go through the cited paper to get crucial 
details about the model. For example, the method lacks a description of all the 
ion channels incorporated in the model. IAHP is mentioned abruptly in the Results 
describing Figure 4. No rationale is provided for incorporating only IAHP, other 
than Ih, in the model.
**** original 
\subsection*{Cell Model}
In this study, we used a previous model of a neocortical layer 5b (L5b) pyramidal neuron \citep{Hay2011-if, Kelley2021-hr} --  
a thick-tufted (corticospinal, pyramidal-tract-type, PT) principle cell which projects to subcortical brain structures. 
The model incorporates a combination of \ih\ and TASK-like shunting current as described in Migliore \& Migliore (2012), with
constant HCN channel density in the soma and basal dendrites and exponentially increasing density with distance from the soma in apical dendrites.
Using this model, we previously showed location-dependent, subthreshold impedance amplitude and phase profiles in close agreement with experimental
observations \citep{Kelley2021-hr}.
Additional details of the original cell model can be found in Hay et al (2011).
**** new 
In this study, we used a previous model of a neocortical layer 5b (L5b) pyramidal neuron from rat \parencite{Hay2011-if, Kelley2021-hr} --  
a thick-tufted (corticospinal, pyramidal-tract-type, PT) principle cell which projects to subcortical brain structures. 
The model included slow inactivating \k\ current (\parencite{Korngreen2000-wc}) and fast inactivating \k\ current \parencite{Korngreen2000-wc} expressed at the soma;
fast inactivating \na\ current \parencite{Colbert2002-pd}, persistent \na\ current \parencite{Magistretti1999-hx}, fast non-inactivating \k\ current (Kv3.1, \parencite{Rettig1992-gw}), 
and small conductance \ca\ activated \k\ current (SK, \iahp, \parencite{Kohler1996-xd}) expressed at constant densities in the soma and dendrites,
and muscarinic \k\ current (\im, \parencite{Adams1982-yj}) expressed at constant density throughout the dendrites.
The model also included high voltage activated (HVA) \ca\ current (I$_{HVA}$), \parencite{Reuveni1993-ov}) and and low voltage activated (LVA) \ca\ current (I$_{LVA}$, T-type \ca\ channel, \parencite{Avery1996-mk, Randall1997-bl} ).
LVA and HVA \ca\ channels was expressed most strongly in a 'hot zone' between 685 and
885 mm from the soma, where their expression was 100 and 10 times higher, respectively, than elsewhere in the dendrites or soma, where their density was constant.
Equations governing the spatial distributions and kinetics of these channels are fully described in Hay et al (2011).
The original model included a non-specific cation current (HCN channel, \ih) (\parencite{Kole2006-bm}) expressed in constant density in the soma and basal dendrites 
and with increasing density with distance from the soma in the apical dendrites.
We replaced the original model of \ih\ with a combination of \ih\ and a Twik-associate acid sensitive \k (TASK)-like shunting current as described in Migliore \& Migliore (2012).  
The expression of \ih\ and TASK-like shunting current followed the same distribution for \ih\ in the original model.
Previous work demonstrated that this version of the model, unlike the original or a number of other detailed models of L5b pyramidal neurons, 
exhibited realistic location-dependent subthreshold impedance properties (e.g. resonance frequency, synchronous frequency) \parencite{Kelley2021-hr},
and that motivated its use in this study.
Unless otherwise noted, simulations in this study were run using this model (\textbf{Model 1}).

To compliment our simulations in \textbf{model 1}, we also used another model of 
neocrotical L5b pyramidal neuron from mouse \citep{Neymotin2017-dr, Dura-Bernal2022-hc, Kelley2021-hr}.
We refer to this model as \textbf{model 2}.
\textbf{Model 2} had a different morphology and different ion channels with different distributions.
Of particular interest to this study, the expression of \ih\ saturated in the apical tufts rather than increasing exponentially as in \textbf{Model 1}.
Furthermore, \textbf{model 2} include A-type \k\ currents (\ia) expressed at constant density in the dendrites and soma.
Like \textbf{model 1}, \textbf{model 2} includes a combination of \ih\ and a Twik-associate acid sensitive \k (TASK)-like shunting current 
as described in Migliore \& Migliore (2012) and exhibited realistic location-dependent subthreshold impedance properties \citep{Kelley2021-hr}.
Further details about the model, its ion channels, and their distributions may be found in Neymotin et al (2017), Dura-Bernal et al (2022), and Kelley et al. (2021).

# \ih, which generates the phenomenological inductance producing resonance and synchrony, is defined as:
# \begin{equation} I_h(x) = g_h(x)l(v-v_{revh}) \label{eq:00}\end{equation}
# where g_h(x) is the local peak conductance at $x \mum$ from the soma (following the distribution mentioned above), 
# $l$ is the activation variable, and $v_{refh}=-30$ mV.
# The time constant for the activation variable, $\tau_h$, which has been shown to influence the phenomenological inductance generated by \ih\ \citep{Narayanan2008-zw},
# was a function of \vmemb\ and temperature (all simulations were run at 34\deg\ C).

**** some of these are only in the soma

*** Further, spatio-kinetic interactions among several ion channels regulate 
neuronal physiology, including the I/O phase profile that the authors investigate. 
Impedance phase lead caused by the phenomenological inductance generated by Ih is 
subject to modulation by other sub-threshold currents such as I-KA and I-CaT (e.g., 
Rathour & Narayanan, J Physiol., 2012; Rathour & Narayanan, PNAS, 2014). Thus, to 
be able to extrapolate their findings on the I/O phase profile to physiologically 
relevant conditions, it is important that authors analyze the impact of such ion 
channel interactions in their study.
**** I-KA / SKv3.1 modulates phase shift for depolarization, not hyperpolarization 
**** I-CaT / LVA Ca2+ channel strongly modulates phase shifts near hot zone,
no effect at soma 
**** new paragraph 
Previous work demonstrated that the phenomenological inductance generated by \ih\ 
was modulated by other subthreshold currents such as \ia, t-type \ca\ current, and 
TASK-like shunting current \cite{Rathour2012-bu, Rathour2014-pl, Kelley2021-hr}.
Our simulations predict location-dependent modulation of I/O phase shifts by a number 
of different currents (\fref{subthresholdBlockChannels}).
Blocking Skv3.1 channels selectively modulated the phase shifts for depolarization,
not hyperpolarization, at the soma (\fref{subthresholdBlockChannels}A).  
This resulted in less phase lead for depolarization.
Blocking Skv3.1 channels had no influence on phase shifts in the apical dendrite.
Conversely, blocking \im\ and LVA \ca\ channels selectively modulated phase shifts for both depolarization and 
hyperpolarization in the apical dendrites, but not at the soma (\fref{subthresholdBlockChannels}B, C).
Blocking either \im\ or LVA \ca\ channels had nearly identical effects on phase shifts in the apical dendrite, 
increasing phenomenological inductance and phase lead.
Blocking the TASK-like shunting effected I/O phase shifts both at the soma and in the apical dendrite, 
reducing phenomenological inductance and phase lead (\fref{subthresholdBlockChannels}D).
As Model 1 did not include \ia, we simulated \ia\ blockad in \textbf{Model 2} (supp fig).
Blocking \ia\ modulated phase shifts more strongly for depolarization than hyperpolarization and more 
strongly at the soma than in the apical dendrite.

*** Suprathreshold-membrane I/O phase response should also depend on the M-type 
K+ currents. The authors propose that the suprathreshold-membrane I/O phase 
response can explain phase precession and phase roll observed in the hippocampal 
and cortical pyramidal neurons. These neurons do express the M-type K+ currents. 
Thus, to get a better physiological insight, the interactions between Ih and IKM 
should be probed for a comprehensive understanding of the I/O phase shift.
**** for subthreshold, Im modulates phenom inductance in dendrites, not at soma 

*** The I/O phase lead caused by the phenomenological inductance of Ih critically 
depends on the activation/deactivation time constants of Ih (Narayanan & Johnston, 
JNS 2008), which varies with HCN channel subtypes (HCN1-4). It is, therefore, 
surprising that for a study that analyzes the differences in Vm phase-shift in 
response to depolarizing vs. hyperpolarizing inputs, a sensitivity analysis of 
the activation time constant for Ih is lacking.
**** new figure for Tau sensitivity of phase shifts 

*** To make their claims more generalizable, it would be nice to assess the 
extent of phase precession and phase retreat in models of different morphologies 
as well as in the models of CA1 pyramidal neurons.
**** tried morphology - decent transfer for subthreshold, poor transfer for spiking

*** A figure for the morphology of the model neuron will also be helpful to the 
reader.
**** added to fig 1 
**** new caption 
\caption{{\bf High amplitude stimuli produced nonlinear \vmemb\ responses with different phase shifts for depolarization and hyperpolarization.}
    A. Morphology of L5b neuron with input signal, symmetric chirp current stimulus (black), and output signal, asymmetric changes in \vmemb.
    B. Single cycle of symmetrical, sinusoidal current stimulus (black, bottom) which produced asymmetric \vmemb\ response (blue, top). 
    Superscripted plus ($^+$) and minus ($^-$) respectively label depolarizing and hyperpolarizing half-cycle peaks. 
    Times of the \vmemb\ peaks and troughs were mapped onto instantaneous stimulus phase.
    Difference in instantaneous stimulus phase between time of peak \vmemb\ to peak in stimulus (triangle to star, \phip) or trough to trough (square to circle \phin) was the value of the phase shift: 
    here, \phip$=0.13$ , \phin$=0.40$ for a 3 Hz input. Both are positive, indicating phase lead (\vmemb\ peak preceding stimulus peak) for both.}

*** Discussion "Phase shift relative to the local field potential (LFP) suggests 
phase coding as an adjunct to rate coding in the central nervous system (CNS)." 
It is unclear how phase coding is an adjunct to rate coding. Adjunct is a very 
strong word used in this context.
**** adjunct is poor word choice. 
**** original 
Phase shift relative to the local field potential (LFP)
suggests phase coding as an adjunct to rate coding in the central nervous system (CNS) 
\parencite{Magee2001-ud, Mehta2002-uu, Harris2002-fb, Fries2007-zs, Leung2011-xe}.
**** new
Phase shift relative to the local field potential (LFP) 
provides a mechanism for temporal/phase coding to coexist with and compliment 
rate coding in the central nervous system (CNS) 
\parencite{Magee2001-ud, Mehta2002-uu, Harris2002-fb, Fries2007-zs, Leung2011-xe}.
... In hippocampal place cells, firing rate provides a coarse grained encoding of 
the animal's location in an arena. During phase precession, place spiking occurs earlier on successive cycles of the theta wave as an animal moves towards the center of a place field,
providing a temporal encoding of location within the place field \parencite{OKeefe1993-xh}. 

* [2023-6-1 Thu] - subthreshold sims 
** differences with different morphologies
*** subthreshold: v1.asc was more excitable, required lower amplitude stimulus for subthresh-nonlinear 
*** phase advance: morphology has an effect (in cell3 no advance)
** channels 
*** SKv3.1
**** modulates phase shift for depolarization, not hyperpolarization 
**** phase retreat: skips most cycles, less phase retreat, weirder with higher amp stim 
**** same issue with phase advance 
*** I-CaT / LVA Ca2+
**** channel strongly modulates phase shifts near hot zone,
no effect at soma 
**** blocking LVA Ca2+ reduces phase retreat when stim soma or apical trunk
**** more complicated wrt phase advance, both at soma and apical trunk 
*** Im 
**** modulates phenom inductance in dendrites, not at soma 
**** similar for phase advance and phase retreat 

* [2023-6-2 Fri] - sensitivity to tau 
** just multiplying taul by factor (ran *0.5 - *1.5)
*** run sims: *tauFactor.sh* plotting: *plotTauFactor.py*
** clear effects on subthreshold, fairly robust to changes in Ih

* [2023-6-5 Mon] - most sims have run 
** figure for subthreshold, soma & apical, diffrerent channels blocked 
** same for phase advance and retreat (thinking supplemental)
** figure for how morphology affects all three 
** figure for tau scaled 50-150%
*** separate panel for tau vs v, want to combine 

* [2023-6-7 Wed] - addressing comments 
** worth metioning small amplitude assymetry when stimulating apical dendrite 
still produces large phase shifts / differences in total inductive phase 
** Kv3.1 not really Ika 

* [2023-6-8 Thu] - salva/sam's cell 
** nice results from M1 cell 
*** phase advance actually much cleaner 
*** has KA - testing whether that effects phase shifts

* [2023-6-12 Mon] - trouble getting migliore's model running 
** had code for it, but can't get running 
*** currently getting enourmous h.t and negative h.dt after f.advance 

* TODOS 
** TODO: new traces - baseline should be blue for consistency with existing figs 
** TODO: check asymmetry of apical responses 
** DONE: copy references over from Hay
** DONE: add morph / schem to fig 1
** TODO: rewrite 'adjunct'
** TODO: fix references 
** DONE: different morphologies
** DONE: sensitivity analysis Ih time constant 
** DONE: block Ca_LVA and Kv1.3 
** DONE: block task for phase advance and retreat 
** TODO: greater description of the cell model 
** TODO: clinical relevance of Iahp
** DONE: New & Noteworthy (75 words)
** DONE: edit cover letter 
** TODO: graphical abstract 
** DONE: put supp fig on figshare
** DONE: get rid of time axis on fig 1 
** DONE: check with bill about dots for synchrony point, highlighting, use of "RMP", and compound vs. composite, more on location dependence, inhibition and bill's paper
*** no highlighting 
*** DONE: add dots for synchrony points 
** DONE: check is das narayanan 2017 is really right paper to cite where cited (since not focused on dendrites)
** DONE: add context/background on rhythmic/oscillatory inputs, dendrites (Kubie)
*** partly done 
** DONE: paragraph addressing Fries, Singer, phase coding, etc.
** DONE: run sims for input phi +/- in dends 
** DONE: address advance/retreat at other frequencies (i.e. different amplitudes)
*** leaving be for right now.  can mention in text for phase advance. clearly visible for 
retreat
** DONE: rerun retreat sims for slope 0.5 
*** running locally 
** DONE: reverse order of plots for neuromod figure 
** DONE: manipulate gmax for ih 
*** decreases in gbad_hd had minimal effects, but increasing it quickly resulted 
in unexcitability, for now going to leave out, but raises the question of whether 
it's better off using M1 cell
** DONE: decide whether blocking Ih should go into neuromodulation or leave where it is 
*** staying where it is 
** DONE: need to decide whether to use slope factor of 1 (which has spike doublets) 
or 0.5 (which is not quite monotonic) for phase retreat / ramp chirp
** DONE: include bandpassed spiking mentioned in Ulrich in intro 
** DONE: consider focusing on dendritic stimulation for phase retreat 
*** much nicer
** DONE: consider replacing amplitude panels with mean/holding current 
*** seems to make a sizeable difference for phase advance, not so much for phase retreat 
** DONE: consider adding comparison between phase advance and spike frequency adaptation 
*** at least include in mention in text 
** DONE: rerun neuromodulation for apical dendrite / phase retreat 
** DONE: finalize figs - want consistent representations for "base" stimuli 
** DONE: rewrite results (and anything else) to reflect switch of focus to apical 
** DONE: incorporate discussion of buzsaki paper 
** DONE: add refs for impedance in intro 
** DONE: add simulations/code availablity section to methods 
** DONE: finish plot showing traces and impedance phase for linear sub, nonlinear sub, supra w/ TTX, and supra 
** DONE: convert other figures from phase via hilbert to new method 
** DONE: consider new fig explaining method 
*** looks crummy 
** DONE: neuromodulation for nonlinear, subthreshold 
** DONE: rewrite text accordingly 
*** finished through results, need to do discussion 
*** DONE: introduce inductive phase?
**** for now, no
*** DONE: introduce leading phase and synchronous frequency in methods 
** DONE: change resting vmemb to holding vmemb 
** DONE: new RMPs
** DONE: maybe new amplitudes 
** DONE: maybe add methods fig
** DONE: remove neuromod 
*** rationale: two vhalfs in .mod, tiny effects, enough going on without it 
** DONE: try extracting exp data from ulrich 
*** really noisy, webplotdigitizer doesn't sample evenly
*** didn't need exp data for first paper 
** DONE: update methods fig 
** DONE: look into two vhalfs 
** DONE: update trace for phase retreat 
** DONE: scale bars for traces 
** DONE: SK->AHP
** DONE: get rid of panel titles  
** DONE: soma version of phase advance  
** DONE: phase retreat/advance versions with slopes for location 
*** don't like 
** DONE: add some lines on pena's amplitude 
** DONE: add paragraph advocating combo of pena and our methods 
*** papers that address assymmetry of the voltage response 
Rotstein2014-bt, Tohidi2009-uc, Schreiber2009-xf, Rotstein2015-kb, Fischer2018-fi
*** papers with asymmetric responses used to compute classical impedance 
Rich2020-yl, Ulrich2002-dd
*** draft 
Recent work has begun to address the limitations of classical impedance analysis
and explore the filtering properties of neuronal membranes in a physiologically relevant \vmemb\ regime \citep{Rotstein2014-bt, Tohidi2009-uc, Schreiber2009-xf, Rotstein2015-kb, Fischer2018-fi}.
\citet{Pena2019-qv} developed an analog to impedance amplitude for this nonlinear,
physiological regime, and here we have developed a complimentary analog to impedance phase. 
We advocate advocate for a using a combination of the two in future studies addressing the 
impedance properties of neurons.
They can serve as a check on the linearity of \vmemb\ measurements used to compute traditional 
impedance, as nonlinearity introduces error.
What is more, they can reveal how nonlinearities introduced by voltage-gated ion 
channels can give rise to differing dynamics for depolarization and hyperpolarization.
Here we showed how even small nonlinearities can produce substantially different phase 
relationships for hyperpolarization and depolarization and produce nonstationary 
spiking patterns that increase information encoding capacity of the neuron.